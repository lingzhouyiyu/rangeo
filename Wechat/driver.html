<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

	<head>
		<title>添加驾驶员</title>
		<meta charset="utf-8">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link href="common/css/mui.min.css" rel="stylesheet" />
		<link href="common/css/mui.picker.min.css" rel="stylesheet" />
		<link href="common/css/fonts/font-awesome.min.css" rel="stylesheet" />
		<link href="common/css/icon.css" rel="stylesheet" />
		<link href="common/css/ui-base.css" rel="stylesheet" />
		<link href="common/css/ui-box.css" rel="stylesheet" />
		<link href="common/css/ui-color.css" rel="stylesheet" />
		<link href="common/css/common.css" rel="stylesheet" />
		<link href="common/css/control.css" rel="stylesheet" />
		<link href="maincss/adduser.css" rel="stylesheet" />

	</head>

	<body class="bc-text um-vp bc-bg">
		<div class="ub ub-ver">
			<div class="ub first-box">
				<div class="ub ub-f1 ub-ver first-main">
					<div class="ub  first-item pagebox"  id="company">
						<div class="ub ub-ac put-left marr1">
							运输公司
						</div>
						<a href="#companypage" class="ub ub-f1">
							<div class="ub ub-ac ub-f1 uinput sc-text companytxt">
								点击选择
							</div>
							<div class="ub ub-ac find_rightImg">
								<img src="common/images/icon_grayR.png" />
							</div>
						</a>
					</div>
					<div class="ub  first-item">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>姓名
						</div>
						<div class="ub ub-ac ub-f1 uinput">
							<input type="text" placeholder="请输入姓名" class="Name" />
						</div>
					</div>
					<div class="ub first-item">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>身份证
						</div>
						<div class="ub ub-ac ub-f1 uinput">
							<input type="text" placeholder="请输入身份证" class="IDNumber" />
						</div>
					</div>
					<div class="ub first-item">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>手机号
						</div>
						<div class="ub ub-ac ub-f1 uinput">
							<input type="text" placeholder="请输入手机号" class="Mobile" />
						</div>
					</div>
					<div class="ub first-item">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>驾驶证
						</div>
						<div class="ub ub-ac ub-f1 uinput">
							<input type="text" placeholder="请输入驾驶证" class="DriverLicenseNo" />
						</div>
					</div>
					<div class="ub first-item">
						<div class="ub ub-ac put-left marr06">
							<span class="colred">* </span>住址
						</div>
						<div class="ub ub-ac ub-f1 uinput">
							<input type="text" placeholder="请输入住址" class="Address" />
						</div>
					</div>
				</div>
			</div>
			<div class="ub second-box umar-b">
				<div class="ub ub-f1 ub-ver first-main">
			
					<div class="ub first-item">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>性别
						</div>
						<div class="ub ub-f1">
							<div class="ub ub-f1 ub-ac ub-pc ub-fh">
								<div class="radiobox colhgreen umar-r">
									<input type="radio" name="radio" value="0" checked="checked" class="uabs ub-con checkticket" rel="0">
								</div>
								<div class="ub ub-ac">男</div>
							</div>
							<div class="ub ub-f1 ub-ac ub-pc ub-fh">
								<div class="radiobox colhgreen umar-r">
									<input type="radio" name="radio" value="1" class="uabs ub-con checkticket" rel="0">
								</div>
								<div class="ub ub-ac">女</div>
							</div>
						</div>
					</div>
					<div class="ub first-item checknation">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>国家
						</div>
						<div class="ub ub-ac ub-f1 uinput sc-text nationtxt">
							点击选择
						</div>
						<div class="ub ub-ac find_rightImg">
							<img src="common/images/icon_grayR.png" />
						</div>
					</div>
					<div class="ub first-item checknality">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>民族
						</div>
						<div class="ub ub-ac ub-f1 uinput sc-text nalitytxt">
							点击选择
						</div>
						<div class="ub ub-ac find_rightImg">
							<img src="common/images/icon_grayR.png" />
						</div>
					</div>
					<div class="ub first-item checkBirth">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>出生日期
						</div>
						<div class="ub ub-ac ub-f1 uinput sc-text Birthtxt">
							点击选择
						</div>
						<div class="ub ub-ac find_rightImg">
							<img src="common/images/icon_grayR.png" />
						</div>
					</div>
					<div class="ub first-item checkfirst">
						<div class="ub ub-ac put-left umar-r">
							<span class="colred">* </span>初次领证日期
						</div>
						<div class="ub ub-ac ub-f1 uinput sc-text firsttxt">
							点击选择
						</div>
						<div class="ub ub-ac find_rightImg">
							<img src="common/images/icon_grayR.png" />
						</div>
					</div>
					<div class="ub first-item checkcartype">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>准驾车型
						</div>
						<div class="ub ub-ac ub-f1 uinput sc-text cartypetxt">
							点击选择
						</div>
						<div class="ub ub-ac find_rightImg">
							<img src="common/images/icon_grayR.png" />
						</div>
					</div>
					<div class="ub first-item checkstart">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>有效期始
						</div>
						<div class="ub ub-ac ub-f1 uinput sc-text starttxt">
							点击选择
						</div>
						<div class="ub ub-ac find_rightImg">
							<img src="common/images/icon_grayR.png" />
						</div>
					</div>
					<div class="ub first-item checkend">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>有效期止
						</div>
						<div class="ub ub-ac ub-f1 uinput sc-text endtxt">
							点击选择
						</div>
						<div class="ub ub-ac find_rightImg">
							<img src="common/images/icon_grayR.png" />
						</div>
					</div>
					<div class="ub first-item">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>档案编号
						</div>
						<div class="ub ub-ac ub-f1 uinput">
							<input type="text" placeholder="请输入档案编号" class="FileNo" />
						</div>
					</div>
				</div>
			</div>
			<div class="ub second-box">
				<div class="ub ub-f1 ub-ver third-main">
					<div class="ub ub-ac header-main">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>头像
						</div>
						<div class="ub ub-ac ub-pc add-header colblue" id="head" onclick="upimg(this)">
							<label for="headtxt">+</label>
							<input id="headtxt" type="file" name="files" accept="image/*,audio/*" style="display: none" />
						</div>
						<div class="ub ub-ac ub-pc imgShow">
							<img class="headimg" src="" alt="">
						</div>
					</div>
				</div>
			</div>
			<div class="ub second-box">
				<div class="ub ub-f1 ub-ver third-main">
					<div class="ub ub-ac header-main">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>驾驶证
						</div>
						<div class="ub ub-ac ub-pc add-header colblue" id="drive" onclick="upimg(this)">
							<label for="drivetxt">+</label>
							<input id="drivetxt" type="file" name="files" accept="image/*,audio/*" style="display: none" />
						</div>
						<div class="ub ub-ac ub-pc imgShow">
							<img class="driveimg" src="" alt="">
						</div>
					</div>
				</div>
			</div>
			<div class="ub second-box">
				<div class="ub ub-f1 ub-ver third-main">
					<div class="ub ub-ac header-main">
						<div class="ub ub-ac put-left">
							<span class="colred">* </span>身份证
						</div>
						<div class="ub ub-ac ub-pc add-header colblue" id="idcar" onclick="upimg(this)">
							<label for="idcartxt">+</label>
							<input id="idcartxt" type="file" name="files" accept="image/*,audio/*" style="display: none" />
						</div>
						<div class="ub ub-ac ub-pc imgShow">
							<img class="idcarimg" src="" alt="">
						</div>
					</div>
				</div>
			</div>
			<div class="ub second-box">
				<div class="ub ub-f1 ub-ver third-main">
					<div class="ub ub-ac header-main">
						<div class="ub ub-ac put-left marr06">
							从业资格证
						</div>
						<div class="ub ub-ac ub-pc add-header colblue" id="vic" onclick="upimg(this)">
							<label for="victxt">+</label>
							<input id="victxt" type="file" name="files" accept="image/*,audio/*" style="display: none" />
						</div>
						<div class="ub ub-ac ub-pc imgShow">
							<img class="vicimg" src="" alt="">
						</div>
					</div>
				</div>
			</div>
			<div class="ub btn_box">
				<div class="ub ub-f1 ub-ac ub-pc main_btn sendbtn">
					确认添加
				</div>
			</div>
		</div>
		<!--筛选-->
		<div class="filter_box switch_page dhide" id="companypage">
			<div class="ub ub-ver filter_main">
				<div class="ub wrap-search">
					<div class="ub ub-f1 search_box">
						<div class="ub ub-ac ub-f1 ele_search uinput ele_put">
							<input class="ulev-ele searchclass" id="searchclass" type="text" placeholder="公司名称或首字母" />
						</div>
					</div>
				</div>
				<div class="ub ub-ver companylist">
					
				</div>
			</div>
		</div>
		<div class="companytemp dhide">
			<div class="ub ub-ac company-item">
				云南现代
			</div>
		</div>
	</body>

</html>
<script src="common/js/jquery-2.1.4.min.js"></script>
<script src="common/js/mui.min.js"></script>
<script src="common/js/mui.picker.min.js"></script>
<script src="common/js/uploadImg.js"></script>
<script src="Fsuperjs/Fsuper.js"></script>
<script>
	$(function() {
location.hash = 'mainpage';
		window.onhashchange = function(e) {
			var oldHash = e.oldURL.split('#')[1];
			var newHash = e.newURL.split('#')[1];
			if(oldHash == "mainpage") {
				return;
			}
			$("#" + oldHash).addClass("pt-page-moveToTop").removeClass("pt-page-moveFromTop");
		
		};
		getcompany();
	});
	
	
	//页面切换
	$(".pagebox").click(function() {
		var id = $(this).attr("id");
		id = id + "page";
		$("#" + id).removeClass("dhide").addClass("pt-page-moveFromTop");
		$("#" + id).removeClass("pt-page-moveToTop");
		location.hash = id;
	});
	
	//页面关闭
	function dbgoback() {
		$(".switch_page").addClass("pt-page-moveToTop").removeClass("pt-page-moveFromTop");
	}
	
	var openId = localStorage.getItem("openid");
	var Nation, Nationality, Classtype;
	var nationarry = [{
		value: '中国',
		text: '中国'
	}, {
		value: '港澳台',
		text: '港澳台'
	}, {
		value: '外国',
		text: '外国'
	}];
	var nalityarry = [{
		value: '汉族',
		text: '汉族'
	}, {
		value: '回族',
		text: '回族'
	}, {
		value: '白族',
		text: '白族'
	}];
	var cartypearry = [{
		value: 'A1',
		text: 'A1'
	}, {
		value: 'A2',
		text: 'A2'
	}, {
		value: 'A3',
		text: 'A3'
	}, {
		value: 'B1',
		text: 'B1'
	}, {
		value: 'B2',
		text: 'B2'
	}, {
		value: 'C1',
		text: 'C1'
	}, {
		value: 'C2',
		text: 'C2'
	}, {
		value: 'C2',
		text: 'C2'
	}, {
		value: 'C3',
		text: 'C3'
	}, {
		value: 'C4',
		text: 'C4'
	}, {
		value: 'C5',
		text: 'C5'
	}, {
		value: 'D',
		text: 'D'
	}, {
		value: 'E',
		text: 'E'
	}, {
		value: 'F',
		text: 'F'
	}, {
		value: 'M',
		text: 'M'
	}, {
		value: 'N',
		text: 'N'
	}, {
		value: 'P',
		text: 'P'
	}];
	$('.checknation').on('click', function() {
		var picker = new mui.PopPicker();
		picker.setData(nationarry);
		picker.show(function(item) {
			console.log(item);
			$('.nationtxt').text(item[0].text);
			$('.nationtxt').css('color', '#5d5d5d');
			Nation = item[0].value;
		})
	})
	$('.checknality').on('click', function() {
		var picker = new mui.PopPicker();
		picker.setData(nalityarry);
		picker.show(function(item) {
			$('.nalitytxt').text(item[0].text);
			$('.nalitytxt').css('color', '#5d5d5d');
			Nationality = item[0].value;
		})
	})
	$('.checkBirth').on('click', function() {
		var Date = new mui.DtPicker({
			type: 'date',
			beginYear: 1950
		});
		Date.show(function(item) {
			$('.Birthtxt').text(item);
			$('.Birthtxt').css('color', '#5d5d5d');
			Birthday = item;
		})
	})
	$('.checkfirst').on('click', function() {
		var Date = new mui.DtPicker({
			type: 'date',
			beginYear: 1950
		});
		Date.show(function(item) {
			$('.firsttxt').text(item);
			$('.firsttxt').css('color', '#5d5d5d');
			FirstIssueDate = item;
		})
	})
	$('.checkcartype').on('click', function() {
		var picker = new mui.PopPicker();
		picker.setData(cartypearry);
		picker.show(function(item) {
			$('.cartypetxt').text(item[0].text);
			$('.cartypetxt').css('color', '#5d5d5d');
			Classtype = item[0].value;
		})
	})
	$('.checkstart').on('click', function() {
		var Date = new mui.DtPicker({
			type: 'date',
			beginYear: 1950
		});
		Date.show(function(item) {
			$('.starttxt').text(item);
			$('.starttxt').css('color', '#5d5d5d');
			FirstIssueDate = item;
		})
	})
	$('.checkend').on('click', function() {
		var Date = new mui.DtPicker({
			type: 'date',
			beginYear: 1950
		});
		Date.show(function(item) {
			$('.endtxt').text(item);
			$('.endtxt').css('color', '#5d5d5d');
			ValidDateEnd = item;
		})
	});
	
	//查询运输公司
	var keyword = '';
	var curname = '';
	var curcomid = '';
	function getcompany() {
		var furl = '/Wechat/Api/GetCompanyJsonList/';
		var pagination = {
			rows: 100,
			page: 1,
			sidx: 'CreateDate',
			sord: 'desc'
		}
		var queryJson = {
			keyword: keyword
		}
		senddata = {
			queryJson: queryJson,
			pagination: pagination
		}
		$.ajax({
			url: Serverurl + furl,
			type: "POST",
			async: false,
			dataType: "json",
			data: senddata,
			success: function(result) {
				var length = 0;
				if (result.type == 1) {
					var datas = result.resultdata;
					length = datas.rows.length;
					if (length > 0) {
						for (var i = 0; i < length; i++) {
							addcompany(datas.rows[i]);
						}
	
					}
	
				} else {
	
				}
	
			},
			error: function() {
				mui.toast("网络错误")
			}
		});
	}
	
	function addcompany(datas) {
		var list = $(".companylist");
		var item = $(".companytemp .company-item").clone();
		item.text(datas.Name);
		item.attr('Id', datas.Id);
		item.attr('Name', datas.Name);
		item.attr('onclick', "checkcar(this)");
		list.append(item);
	}
	function checkcar(dom) {
		curname = $(dom).attr("Name");
		curcomid = $(dom).attr('Id');
		$('.companytxt').text(curname);
		$('.companytxt').css('color', '#5d5d5d');
		dbgoback();
	}
	document.getElementById('searchclass').addEventListener('input', function(e) {
		keyword = $('.searchclass').val();
		$(".companylist").empty();
		getcompany();
	});
	
	//图片上传
	function upimg(dom) {
		var curid = $(dom).attr('id');
		var id = curid + 'txt';
		var cursrc = curid + 'img';
		uploadImg({
			maxNum: 1920, //压缩后照片 最大宽度/高度
			rate: 1, //清晰度比率 0-1 越小照片大小越小但越不清晰 默认0.8
			curid: id,
			callback: function(baseUrl) { // 回调函数返回压缩成功后的
				$(dom).siblings('.imgShow').find('.' + cursrc).attr("src", baseUrl);
			}
		});
	}

	function adddriver() {
		var furl = '/Wechat/Api/AddDriver/';
		var Name = $('.Name').val();
		var IDNumber = $('.IDNumber').val();
		var Mobile = $('.Mobile').val();
		var Address = $('.Address').val();
		var DriverLicenseNo = $('.DriverLicenseNo').val();
		var FileNo = $('.FileNo').val();
		var sex = '男';
		var sexcheck = $(".checksex").prop("checked");
		var FileNo = $('.FileNo').val();
		var HeadIcon = $('.headimg').attr("src");
		var DriverLicenseImg = $('.driveimg').attr('src');
		var IDImg = $('.idcarimg').attr('src');
		var VCImg = $('.vicimg').attr('src');
		var Birthday = $.trim($('.Birthtxt').text());
		var FirstIssueDate = $.trim($('.firsttxt').text());
		var ValidDateBegin = $.trim($('.starttxt').text());
		var ValidDateEnd = $.trim($('.endtxt').text());
		if (sexcheck == true) {
			sex = '男'
		}
		if (sexcheck == false) {
			sex = '女'
		}

		if (Name == '' || Name == null) {
			mui.toast('请选填写姓名！');
			return;
		}
		if (IDNumber == '' || IDNumber == null) {
			mui.toast('请选填写证件号！');
			return;
		}
		if (Mobile == '' || Mobile == null) {
			mui.toast('请选填写手机号！');
			return;
		}
		if (DriverLicenseNo == null || DriverLicenseNo == '') {
			mui.toast('请选填写驾驶证号！');
			return;
		}
		if (Address == '' || Address == null) {
			mui.toast('请选填写住址！');
			return;
		}
		if (FileNo == null || FileNo == '') {
			mui.toast('请选填写档案编号！');
			return;
		}

		var queryJson = {
			openId: openId,
			HeadIcon: HeadIcon,
			DriverLicenseImg: DriverLicenseImg,
			IDImg: IDImg,
			VCImg: VCImg,
			entity: {
				CompanyId: curcomid,
				CompanyName: curname,
				Name: Name,
				DriverLicenseNo: DriverLicenseNo,
				Sex: sex,
				Nation: Nation,
				Nationality: Nationality,
				Address: Address,
				Mobile: Mobile,
				Birthday: Birthday,
				FirstIssueDate: FirstIssueDate,
				Class: Classtype,
				ValidDateBegin: ValidDateBegin,
				ValidDateEnd: ValidDateEnd,
				FileNo: FileNo,
				IDNumber: IDNumber,
				VCNo: '',
				VCFirstIssueDate: '',
				VCValidDateBegin: '',
				VCValidDateEnd: '',
				Comment: ''
			}
		}
		//queryJson = JSON.stringify(queryJson);
		console.log(queryJson);
		$.ajax({
			url: Serverurl + furl,
			type: "POST",
			async: false,
			dataType: "json",
			data: queryJson,
			success: function(result) {
				if (result.type == 1) {
					mui.alert(result.message, '系统提示', function() {
						history.back(-2);
					});
				} else {
					mui.toast(result.message);
				}

			}

		});
	}
	$('.sendbtn').on('click', function() {
		adddriver();
	})
</script>
